{
    "abstractText": "Generative adversarial networks (GANs) are a recently prop osed class of generative models in which a generator is trained to optimize a cost function that is being simultaneously learned by a discriminator. While the idea o f learning cost functions is relatively new to the field of generative modeling, l earning costs has long been studied in control and reinforcement learning (RL) dom ains, typically for imitation learning from demonstrations. In these fields, le arning the cost function underlying observed behavior is known as inverse reinforce ment learning (IRL) or inverse optimal control. While at first the connection betwe en cost learning in RL and cost learning in generative modeling may appear to be a su perficial one, we show in this paper that certain IRL methods are in fact mathem atically equivalent to GANs. In particular, we demonstrate an equivalence betwe n a sample-based algorithm for maximum entropy IRL and a GAN in which the gener ato \u2019s density can be evaluated and is provided as an additional input to the discriminator. Interestingly, maximum entropy IRL is a special case of an energybased model. We discuss the interpretation of GANs as an algorithm for train ing energy-based models, and relate this interpretation to other recent work tha t seeks to connect GANs and EBMs. By formally highlighting the connection between G ANs, IRL, and EBMs, we hope that researchers in all three communities can b etter identify and apply transferable ideas from one domain to another, partic ularly for developing more stable and scalable algorithms: a major challenge in al l three domains.",
    "authors": [],
    "id": "SP:e7d4d657cab0c49f41cbd41b6f0f3d3c1ff682a2",
    "references": [
        {
            "authors": [
                "P. Bachman",
                "D. Precup"
            ],
            "title": "Data generation as sequential d ecision making",
            "venue": "InNeural Information Processing Systems (NIPS) ",
            "year": 2015
        },
        {
            "authors": [
                "D. Bahdanau",
                "P. Brakel",
                "K. Xu",
                "A. Goyal",
                "R. Lowe"
            ],
            "title": "J",
            "venue": "Pineau , A. Courville, and Y. Bengio. An actor-critic algorithm for sequence prediction. arXiv preprint arXiv:1607.07086 ",
            "year": 2016
        },
        {
            "authors": [
                "S. Bengio",
                "O. Vinyals",
                "N. Jaitly",
                "N. Shazeer"
            ],
            "title": "Schedul sampling for sequence prediction with recurrent neural networks",
            "venue": "Neural Information Processing Systems (NIPS) ",
            "year": 2015
        },
        {
            "authors": [
                "A. Boularias",
                "J. Kober",
                "J. Peters"
            ],
            "title": "Relative entropy i nverse reinforcement learning",
            "venue": "International Conference on Artificial Intelligence and St atistics (AISTATS) ",
            "year": 2011
        },
        {
            "authors": [
                "L. Dinh",
                "J. Sohl-Dickstein"
            ],
            "title": "and S",
            "venue": "Bengio. Density estim ation using real nvp.arXiv preprint arXiv:1605.08803",
            "year": 2016
        },
        {
            "authors": [
                "C. Finn",
                "S. Levine"
            ],
            "title": "and P",
            "venue": "Abbeel. Guided cost learning: D eep inverse optimal control via policy optimization.International Conference on Machine Learning (ICML) ",
            "year": 2016
        },
        {
            "authors": [
                "I. Goodfellow",
                "J. Pouget-Abadie",
                "M. Mirza",
                "B. Xu"
            ],
            "title": "D",
            "venue": "Ward e-Farley, S. Ozair, A. Courville, and Y. Bengio. Generative adversarial nets. In Neural Information Processing Systems (NIPS) ",
            "year": 2014
        },
        {
            "authors": [
                "J. Ho",
                "S. Ermon"
            ],
            "title": "Generative adversarial imitation lea rning",
            "venue": "Neural Information Processing Systems (NIPS) ",
            "year": 2016
        },
        {
            "authors": [
                "J. Ho",
                "J.K. Gupta",
                "S. Ermon"
            ],
            "title": "Model-free imitation le arning with policy optimization",
            "venue": "International Conference on Machine Learning (ICML) ",
            "year": 2016
        },
        {
            "authors": [
                "M. Kalakrishnan",
                "P. Pastor",
                "L. Righetti",
                "S. Schaal"
            ],
            "title": "Learning objective functions for manipulation",
            "venue": "InInternational Conference on Robotics and Automation (ICRA )",
            "year": 2013
        },
        {
            "authors": [
                "T. Kim",
                "Y. Bengio"
            ],
            "title": "Deep directed generative models wi th energy-based probability estimation",
            "venue": "ICLR Workshop Track ",
            "year": 2016
        },
        {
            "authors": [
                "H. Larochelle",
                "I. Murray"
            ],
            "title": "The neural autoregressive d stribution estimator",
            "venue": "InInternational Conference on Artificial Intelligence and Statistics (AIST ATS)",
            "year": 2011
        },
        {
            "authors": [
                "Y. LeCun",
                "S. Chopra",
                "R. Hadsell",
                "M. Ranzato"
            ],
            "title": "and F",
            "venue": "Huang . A tutorial on energy-based learning.Predicting structured data , 1:0",
            "year": 2006
        },
        {
            "authors": [
                "A. Ng",
                "S. Russell"
            ],
            "title": "et al",
            "venue": "Algorithms for inverse reinfor cement learning. InInternational Conference on Machine Learning (ICML) ",
            "year": 2000
        },
        {
            "authors": [
                "M. Norouzi",
                "S. Bengio",
                "Z. Chen",
                "N. Jaitly",
                "M. Schuster"
            ],
            "title": "Y",
            "venue": "Wu, and D. Schuurmans. Reward augmented maximum likelihood for neural structured predic tion. Neural Information Processing Systems (NIPS) ",
            "year": 2016
        },
        {
            "authors": [
                "S. Nowozin",
                "B. Cseke",
                "R. Tomioka"
            ],
            "title": "f-gan: Training ge nerative neural samplers using variational divergence minimization",
            "venue": "Neural Information Processing Systems (NIPS) ",
            "year": 2016
        },
        {
            "authors": [
                "A. v. d. Oord",
                "S. Dieleman",
                "H. Zen",
                "K. Simonyan",
                "O. Vinyal s",
                "A. Graves",
                "N. Kalchbrenner",
                "A. Senior",
                "K. Kavukcuoglu"
            ],
            "title": "Wavenet: A generative model f or raw audio.arXiv preprint arXiv:1609.03499, 2016",
            "year": 2016
        },
        {
            "authors": [
                "D. Pfau",
                "O. Vinyals"
            ],
            "title": "Connecting generative adversar ial networks and actor-critic methods",
            "venue": "arXiv preprint arXiv:1610.01945 ",
            "year": 2016
        },
        {
            "authors": [
                "M. Ranzato",
                "S. Chopra",
                "M. Auli",
                "W. Zaremba"
            ],
            "title": "Sequence lev l training with recurrent neural networks",
            "venue": "International Conference on Learning Representations (IC LR)",
            "year": 2016
        },
        {
            "authors": [
                "S. Ross",
                "G. Gordon",
                "A. Bagnell"
            ],
            "title": "A reduction of imitat ion learning and structured prediction to no-regret online learning",
            "venue": "Journal of Machine Learning Research , 15",
            "year": 2011
        },
        {
            "authors": [
                "Y. Wu",
                "M. Schuster",
                "Z. Chen",
                "Q.V. Le",
                "M. Norouzi"
            ],
            "title": "W",
            "venue": "Mache rey, M. Krikun, Y. Cao, Q. Gao, K. Macherey, et al. Google\u2019s neural machine translation sys tem: Bridging the gap between human and machine translation. arXiv preprint arXiv:1609.08144 ",
            "year": 2016
        },
        {
            "authors": [
                "L. Yu",
                "W. Zhang",
                "J. Wang"
            ],
            "title": "and Y",
            "venue": "Yu. Seqgan: Sequence gene rativ adversarial nets with policy gradient.arXiv preprint arXiv:1609.05473 ",
            "year": 2016
        },
        {
            "authors": [
                "J. Zhao",
                "M. Mathieu"
            ],
            "title": "and Y",
            "venue": "LeCun. Energy-based generat iv adversarial network.arXiv preprint arXiv:1609.03126 ",
            "year": 2016
        },
        {
            "authors": [
                "B. Ziebart"
            ],
            "title": "Modeling purposeful adaptive behavior with the principle o f maximum causal entropy",
            "venue": "PhD thesis, Carnegie Mellon University",
            "year": 2010
        },
        {
            "authors": [
                "B. Ziebart",
                "A. Maas",
                "J.A. Bagnell",
                "A.K. Dey"
            ],
            "title": "Maximum entropy inverse reinforcement learning",
            "venue": "InAAAI Conference on Artificial Intelligence ",
            "year": 2008
        }
    ],
    "sections": [
        {
            "text": "ar X\niv :1\n61 1.\n03 85\n2v 3\n[c s.\nLG ]\n25 N\nGenerative adversarial networks (GANs) are a recently proposed class of generative models in which a generator is trained to optimize a costfunction that is being simultaneously learned by a discriminator. While the idea of learning cost functions is relatively new to the field of generative modeling, learning costs has long been studied in control and reinforcement learning (RL) domains, typically for imitation learning from demonstrations. In these fields, learning the cost function underlying observed behavior is known as inverse reinforcement learning (IRL) or inverse optimal control. While at first the connection between cost learning in RL and cost learning in generative modeling may appear to be a superficial one, we show in this paper that certain IRL methods are in fact mathematically equivalent to GANs. In particular, we demonstrate an equivalence betwen a sample-based algorithm for maximum entropy IRL and a GAN in which the generato \u2019s density can be evaluated and is provided as an additional input to thediscriminator. Interestingly, maximum entropy IRL is a special case of an energy-based model. We discuss the interpretation of GANs as an algorithm for training energy-based models, and relate this interpretation to other recent work that seeks to connect GANs and EBMs. By formally highlighting the connection between GANs, IRL, and EBMs, we hope that researchers in all three communities can better identify and apply transferable ideas from one domain to another, particularly for developing more stable and scalable algorithms: a major challenge in all three domains."
        },
        {
            "heading": "1 Introduction",
            "text": "Generative adversarial networks (GANs) are a recently proposed class of generative models in which a generator is trained to optimize a cost function that is being s multaneously learned by a discriminator [8]. While the idea of learning objectives is relatively new to the field of generative modeling, learning cost or reward functions has long been studied in control [5] and was popularized in 2000 for reinforcement learning problems [15]. In these fields, learning the cost function underlying demonstrated behavior is referred to as inverse reinforcement learning (IRL) or inverse optimal control (IOC). At first glance, the connection between cost learningin RL and cost learning for generative models may appear to be superficial; however, if we apply GANsto a setting where the generator density can be efficiently evaluated, the result is exactly equivalent to a sample-based algorithm for maximum entropy (MaxEnt) IRL. Interestingly, as MaxEntIRL is an energy-based model, this connection suggests a method for using GANs to train a broadeclass of energy-based models.\nMaxEnt IRL is a widely-used objective for IRL, proposed by Ziebart et al. [27]. Sample-based algorithms for performing maximum entropy (MaxEnt) IRL have scaled cost learning to scenarios\n\u2217 Indicates equal contribution.\nwith unknown dynamics, using nonlinear function classes, such as neural networks [4, 11, 7]. We show that the gradient updates for the cost and the policy in these methods can be viewed as the updates for the discriminator and generator in GANs, under aspecific form of the discriminator. The key difference to a generic discriminator is that we needto be able evaluate the density of the generator, which we integrate into the discriminator in a natural way.\nTraditionally, GANs are used to train generative models forwhich it is not possible to evaluate the density. When it is possible to evaluate the density, for example in an autoregressive model, it is typical to maximize the likelihood of the data directly. By considering the connection to IRL, we find that GAN training may be appropriate even when density values are available. For example, suppose we are interested in modeling a complex multimodal distribution, but our model does not have enough capacity to represent the distribution. Then maximizing likelihood will lead to a distribution which \u201ccovers\u201d all of the modes, but puts most of its mass in parts of the space that have negligible density under the data distribution. These might be images that look extremely unrealistic, nonsensical sentences, or suboptimal robot behavior. A generator trained adversarially will instead try to \u201cfill in\u201d as many of modes as it can, without putting muchmass in the space between modes. This results in lower diversity, but ensures that samples \u201clook like\u201d they could have been from the original data.\nBy drawing an exact correspondence between adaptive, sample-based algorithms for MaxEnt IRL and GAN training, we show that this phenomenon occurs and is practically important: GAN training can significantly improve the quality of samples even when the generator density can be exactly evaluated. This is precisely analogous to the observed ability of inverse reinforcement learning to imitate behaviors that cannot be successfully learned througbehavioral cloning [21], direct maximum likelihood regression to the demonstrated behavior.\nInterestingly, the maximum entropy formulation of IRL is a special case of an energy-based model (EBM) [26]. The learned cost in MaxEnt IRL corresponds to theenergy function, and is trained via maximum likelihood. Hence, we can also show how a particular form of GANs can be used to train EBMs. Recent works have recognized a connection between EBMs and GANs [12, 25]. In this work, we particularly focus on EBMs trained with maximum likelihood, and expand upon the connection recognized by Kim & Bengio [12] for the case where the generator\u2019s density can be computed. By formally highlighting the connection betweenGANs, IRL, and EBMs, we hope that researchers in all three areas can better identify and applytransferable ideas from one domain to another."
        },
        {
            "heading": "2 Background",
            "text": "In this section, we formally define generative adversarial networks (GANs), energy-based models (EBMs), and inverse reinforcement learning (IRL), and introduce notation."
        },
        {
            "heading": "2.1 Generative Adversarial Networks",
            "text": "Generative adversarial networks are an approach to generative modeling where two models are trained simultaneously: a generatorG and a discriminatorD. The discriminator is tasked with classifying its inputs as either the output of the generator, or actual samples from the underlying data distributionp(x). The goal of the generator is to produce outputs that are classified by the discriminator as coming from the underlying data distribution [8].\nFormally, the generator takes noise as input and outputs a sample x \u223c G, while the discriminator takes as input a samplex and outputs the probabilityD(x) that the sample was from the data distribution. The discriminator\u2019s loss is the average log probability it assigns to the correct classification, evaluated on an equal mixture of real samples and outputs from the generator:\nLdiscriminator(D) = Ex\u223cp[\u2212 logD(x)]+Ex\u223cG[\u2212 log(1\u2212D(x))].\nThe generator\u2019s loss can be defined one of several similar ways. The simplest definition, originally proposed in [8], is simply the opposite of the discriminator\u2019s loss. However, this provides very little training signal if the generator\u2019s output can be easily d stinguished from the real samples. It is common to instead use the log of the discriminator\u2019s confusion [8]. We will define the generator\u2019s loss as the sum of these two variants:\nLgenerator(G) = Ex\u223cG[\u2212 logD(x)]+Ex\u223cG[log(1\u2212D(x))]."
        },
        {
            "heading": "2.2 Energy-Based Models",
            "text": "Energy-based models [14] associate an energy valueE\u03b8 (x) with a samplex, modeling the data as a Boltzmann distribution:\np\u03b8 (x) = 1 Z exp(\u2212E\u03b8 (x)) (1)\nThe energy function parameters\u03b8 are often chosen to maximize the likelihood of the data; the main challenge in this optimization is evaluating the partition functionZ, which is an intractable sum or integral for most high-dimensional problems. A common approach to estimatingZ requires sampling from the Boltzmann distributionp\u03b8 (x) within the inner loop of learning.\nSampling fromp\u03b8 (x) can be approximated by using Markov chain Monte Carlo (MCMC)methods; however, these methods face issues when there are several distinct modes of the distribution and, as a result, can take arbitrarily large amounts of time to produce a diverse set of samples. Approximate inference methods can also be used during training, though the energy function may incorrectly assign low energy to some modes if the approximate inferencemethod cannot find them [14]."
        },
        {
            "heading": "2.3 Inverse Reinforcement Learning",
            "text": "The goal of inverse reinforcement learning is to infer the cost function underlying demonstrated behavior [15]. It is typically assumed that the demonstrations come from an expert who is behaving near-optimally under some unknown cost. In this section, wediscuss MaxEnt IRL and guided cost learning, an algorithm for MaxEnt IRL."
        },
        {
            "heading": "2.3.1 Maximum entropy inverse reinforcement learning",
            "text": "Maximum entropy inverse reinforcement learning models thedemonstrations using a Boltzmann distribution, where the energy is given by the cost functionc\u03b8 :\np\u03b8 (\u03c4) = 1 Z exp(\u2212c\u03b8 (\u03c4)),\nHere, \u03c4 = {x1,u1, . . . ,xT ,uT} is a trajectory;c\u03b8 (\u03c4) = \u2211t c\u03b8 (xt ,ut) is a learned cost function parametrized by\u03b8 ; xt andut are the state and action at time step; and the partition functionZ is the integral of exp(\u2212c\u03b8 (\u03c4)) over all trajectories that are consistent with the environme t dynamics.2\nUnder this model, the optimal trajectories have the highestlikelihood, and the expert can generate suboptimal trajectories with a probability that decreasesexponentially as the trajectories become more costly. As in other energy-based models, the parameters\u03b8 are optimized to maximize the likelihood of the demonstrations. Estimating the partition functionZ is difficult for large or continuous domains, and presents the main computational challenge. The first applications of this model computedZ exactly with dynamic programming [27]. However, this is only practical in small, discrete domains, and is impossible in domains where the system dynamics p(xt+1|xt ,ut) are unknown."
        },
        {
            "heading": "2.3.2 Guided cost learning",
            "text": "Guided cost learning introduces an iterative sample-basedm thod for estimatingZ in the MaxEnt IRL formulation, and can scale to high-dimensional state and action spaces and nonlinear cost functions [7]. The algorithm estimatesZ by training a new sampling distributionq(\u03c4) and using importance sampling:\nLcost(\u03b8 ) = E\u03c4\u223cp[\u2212 logp\u03b8 (\u03c4)] = E\u03c4\u223cp[c\u03b8 (\u03c4)]+ logZ\n= E\u03c4\u223cp[c\u03b8 (\u03c4)]+ log ( E\u03c4\u223cq [ exp(\u2212c\u03b8 (\u03c4))\nq(\u03c4)\n]) .\nGuided cost learning alternates between optimizingc\u03b8 using this estimate, and optimizingq(\u03c4) to minimize the variance of the importance sampling estimate.\n2This formula assumes thatxt+1 is a deterministic function of the previous history. A more general form of this equation can be derived for stochastic dynamics [26]. However, the analysis largely remains the same: the probability of a trajectory can be written as the productof conditional probabilities, but the conditional probabilities of the statesxt are not affected by\u03b8 and so factor out of all likelihood ratios.\nThe optimal importance sampling distribution for estimating the partition function \u222b\nexp(\u2212c\u03b8 (\u03c4))d\u03c4 is q(\u03c4) \u221d |exp(\u2212c\u03b8 (\u03c4))| = exp(\u2212c\u03b8 (\u03c4)). During guided cost learning, the sampling policy q(\u03c4) is updated to match this distribution by minimizing the KL divergence betweenq(\u03c4) and 1 Z exp(\u2212c\u03b8 (\u03c4)), or equivalently minimizing the learned cost and maximizing entropy.\nLsampler(q) = E\u03c4\u223cq[c\u03b8 (\u03c4)]+E\u03c4\u223cq[logq(\u03c4)] (2)\nConveniently, this optimal sampling distribution is the demonstration distribution for the true cost function. Thus, this training procedure results in both a learn d cost function, characterizing the demonstration distribution, and a learned policyq(\u03c4), capable of generating samples from the demonstration distribution.\nThis importance sampling estimate can have very high variance if the sampling distributionq fails to cover some trajectories\u03c4 with high values of exp(\u2212c\u03b8 (\u03c4)). Since the demonstrations will have low cost (as a result of the IRL objective), we can address this coverage problem by mixing the demonstration data samples with the generated samples. Let\u00b5 = 12 p+ 1 2q be the mixture distribution over trajectory roll-outs. Let\u0303p(\u03c4) be a rough estimate for the density of the demonstrations; for example we could use the current modelp\u03b8 , or we could use a simpler density model trained using another method. Guided cost learning uses\u00b5 for importance sampling3, with 12 p\u0303(\u03c4)+ 1 2q(\u03c4) as the importance weights:\nLcost(\u03b8 ) = E\u03c4\u223cp[c\u03b8 (\u03c4)]+ log ( E\u03c4\u223c\u00b5 [ exp(\u2212c\u03b8 (\u03c4))\n1 2 p\u0303(\u03c4)+ 1 2q(\u03c4)\n]) ,"
        },
        {
            "heading": "2.4 Direct Maximum Likelihood and Behavioral Cloning",
            "text": "A simple approach to imitation learning and generative modeling is to train a generator or policy to output a distribution over the data, without learning a discriminator or energy function. For tractability, the data distribution is typically factorized using a directed graphical model or Bayesian network. In the field of generative modeling, this approach has most commonly been applied to speech and language generation tasks [23, 18], but has also been applied to image generation [22]. Like most EBMs, these models are trained by maximizing the likelihood of the observed data points.\nWhen a generative model does not have the capacity to represent the entire data distribution, maximizing likelihood directly will lead to a moment-matchingdistribution that tries to \u201ccover\u201d all of the modes, leading to a solution that puts much of its mass in parts of the space that have negligible probability under the true distribution. In many scenarios, t i preferable to instead produce only realistic, highly probable samples, by \u201cfilling in\u201d as many modes as possible, at the trade-off of lower diversity. Since EBMs are also trained with maximum likelihood, the energy function in an EBM will exhibit the same moment-matching behavior when it has limited capacity. However, designing a flexible energy function to represent a distribution\u2019s density function is generally much easier than designing a tractable generator with the same flexibility, that can to generate samples without a complex iterative inference procedure. Moreover, once we havea trained energy function, the generator is trained to be mode-seeking, by minimizing the KL divergence between the generator\u2019s distribution and the distribution induced by the energy function. Asa result, even if the generator has the same capacity as a generative model trained with direct maxium likelihood, the generator trained with an EBM will exhibit mode-seeking behavior as long as theen rgy function is more flexible than the generator. Of course, this phenomenon is often achievedat the cost of tractability, as generating samples from an energy function requires training a generator which, in the case of IRL, is forward policy optimization.\nIn sequential decision-making domains, using direct maximum likelihood is known as behavioral cloning, where the policy is trained with supervised learning to match the actions of the demonstrating agent, conditioned on the corresponding observations.While this approach is simple and often effective for small problems, the moment-matching behavior of direct maximum likelihood can produce particularly ineffective trajectories because of comp unding errors. When the policy makes a small mistake, it deviates from the state distribution seenduring training, making it more likely to make a mistake again. This issue compounds and eventually, the agent reaches a state far from the\n3In RL settings, where generating samples requires executing a policy in the real world, such as in robotics, old samples from old generators are typically retained for effici ncy. In this case, the densityq can be computed using a fusion distribution over the past generator densities.\ntraining distribution and makes a catastrophic error [21].Generative modeling also faces this issue when generating variables sequentially. A popular approach for handling this involves incrementally sampling more from the model and drawing less from the data istribution during training [21]. This requires that the true data distribution can be sampledfrom during training, corresponding to a human or algorithmic expert. Bengio et al. proposed an approximate solution, termed scheduled sampling, that does not require querying the data distribution [3]. However, while these approaches alleviate the issue, they do not solve it completely."
        },
        {
            "heading": "3 GANs and IRL",
            "text": "We now show how generative adversarial modeling has implicitly been applied to the setting of inverse reinforcement learning, where the data-to-be-modeled is a set of expert demonstrations. The derivation requires a particular form of discriminator, which we discuss first in Section 3.1. After making this modification to the discriminator, we obtain an algorithm for IRL, as we show in Section 3.2, where the discriminator involves the learned costand the generator represents the policy."
        },
        {
            "heading": "3.1 A special form of discriminator",
            "text": "For a fixed generator with a [typically unknown] densityq(\u03c4), the optimal discriminator is the following [8]:\nD\u2217(\u03c4) = p(\u03c4)\np(\u03c4)+q(\u03c4) , (3)\nwherep(\u03c4) is the actual distribution of the data. In the traditional GAN algorithm, the discriminator is trained to directly output this value. When the generator densityq(\u03c4) can be evaluated, the traditional GAN discriminator can be modified to incorporate this density information. Instead of havingthe discriminator estimate the value of Equation 3 directly, it can be used to estimatep(\u03c4), filling in the value ofq(\u03c4) with its known value. In this case, the new form of the discriminatorD\u03b8 with parameters\u03b8 is\nD\u03b8 (\u03c4) = p\u0303\u03b8 (\u03c4)\np\u0303\u03b8 (\u03c4)+q(\u03c4) .\nIn order to make the connection to MaxEnt IRL, we also replacethe estimated data density with the Boltzmann distribution. As in MaxEnt IRL, we write the energy function asc\u03b8 to designate the learned cost. Now the discriminator\u2019s output is:\nD\u03b8 (\u03c4) = 1 Z exp(\u2212c\u03b8 (\u03c4))\n1 Z exp(\u2212c\u03b8 (\u03c4))+q(\u03c4)\n.\nThe resulting architecture for the discriminator is very similar to a typical model for binary classification, with a sigmoid as the final layer and logZ as the bias of the sigmoid. We have adjusted the architecture only by subtracting logq(\u03c4) from the input to the sigmoid. This modest change allows the optimal discriminator to be completely independt of the generator: the discriminator is optimal when1Z exp(\u2212c\u03b8 (\u03c4)) = p(\u03c4). Independence between the generator and the optimal discriminator may significantly improve the stability of training.\nThis change is very simple to implement and is applicable in any setting where the densityq(\u03c4) can be cheaply evaluated. Of course this is precisely the caswhere we could directly maximize likelihood, and we might wonder whether it is worth the additional complexity of GAN training. But the experience of researchers in IRL has shown that maximizing log likelihood directly is not always the most effective way to learn complex behaviors, even when it is possible to implement. As we will show, there is a precise equivalence between MaxEnt IRL and this type of GAN, suggesting that the same phenomenon may occur in other domains: GAN training may provide advantages even when it would be possible to maximize likelihood directly."
        },
        {
            "heading": "3.2 Equivalence between generative adversarial networks and guided cost learning",
            "text": "In this section, we show that GANs, when applied to IRL problems, optimize the same objective as MaxEnt IRL, and in fact the variant of GANs described in the prvious section is precisely equivalent to guided cost learning.\nRecall that the discriminator\u2019s loss is equal to\nLdiscriminator(D\u03b8 ) = E\u03c4\u223cp[\u2212 logD\u03b8 (\u03c4)]+E\u03c4\u223cq[\u2212 log(1\u2212D\u03b8(\u03c4))]\n= E\u03c4\u223cp\n[ \u2212 log\n1 Z exp(\u2212c\u03b8 (\u03c4))\n1 Z exp(\u2212c\u03b8 (\u03c4))+q(\u03c4)\n] +E\u03c4\u223cq [ \u2212 log\nq(\u03c4) 1 Z exp(\u2212c\u03b8 (\u03c4))+q(\u03c4)\n]\nIn maximum entropy IRL, the log-likelihood objective is:\nLcost(\u03b8 ) = E\u03c4\u223cp[c\u03b8 (\u03c4)]+ log ( E\u03c4\u223c 12 p+ 1 2q [ exp(\u2212c\u03b8 (\u03c4))\n1 2 p\u0303(\u03c4)+ 1 2q(\u03c4)\n]) (4)\n= E\u03c4\u223cp[c\u03b8 (\u03c4)]+ log ( E\u03c4\u223c\u00b5 [ exp(\u2212c\u03b8 (\u03c4))\n1 2Z exp(\u2212c\u03b8 (\u03c4))+ 1 2q(\u03c4)\n]) , (5)\nwhere we have substituted\u0303p(\u03c4) = p\u03b8 (\u03c4) = 1Z exp(\u2212c\u03b8 (\u03c4)), i.e. we are using the current model to estimate the importance weights.\nWe will establish the following facts, which together implythat GANs optimize precisely the MaxEnt IRL problem:\n1. The value ofZ which minimizes the discriminator\u2019s loss is an importance-sampling estimator for the partition function, as described in Section 2.3..\n2. For this value ofZ, the derivative of the discriminator\u2019s loss with respect to\u03b8 is equal to the derivative of the MaxEnt IRL objective.\n3. The generator\u2019s loss is exactly equal to the costc\u03b8 minus the entropy ofq(\u03c4), i.e. the MaxEnt policy loss defined in Equation 2 in Section 2.3.2.\nRecall that\u00b5 is the mixture distribution betweenp andq. Write \u00b5\u0303(\u03c4) = 12Z exp(\u2212c\u03b8 (\u03c4))+ 1 2q(\u03c4). Note that when\u03b8 andZ are optimized,1Z exp(\u2212c\u03b8 (\u03c4)) is an estimate for the density ofp(\u03c4), and hence\u0303\u00b5(\u03c4) is an estimate for the density of\u00b5 ."
        },
        {
            "heading": "3.2.1 Z estimates the partition function",
            "text": "We can compute the discriminator\u2019s loss:\nLdiscriminator(D\u03b8 ) =E\u03c4\u223cp\n[ \u2212 log 1 Z exp(\u2212c\u03b8 (\u03c4))\n\u00b5\u0303(\u03c4)\n] +E\u03c4\u223cq [ \u2212 log\nq(\u03c4) \u00b5\u0303(\u03c4)\n] (6)\n= logZ+E\u03c4\u223cp[c\u03b8 (\u03c4)]+E\u03c4\u223cp[log\u00b5\u0303(\u03c4)]\u2212E\u03c4\u223cq[logq(\u03c4)]+E\u03c4\u223cq[log\u00b5\u0303(\u03c4)] (7) = logZ+E\u03c4\u223cp[c\u03b8 (\u03c4)]\u2212E\u03c4\u223cq[logq(\u03c4)]+2E\u03c4\u223c\u00b5 [log\u00b5\u0303(\u03c4)]. (8)\nOnly the first and last terms depend onZ. At the minimizing value ofZ, the derivative of these term with respect toZ will be zero:\n\u2202ZLdiscriminator(D\u03b8 ) = 0\n1 Z = E\u03c4\u223c\u00b5\n[ 1\nZ2 exp(\u2212c\u03b8 (\u03c4))\n\u00b5\u0303(\u03c4)\n]\nZ = E\u03c4\u223c\u00b5\n[ exp(\u2212c\u03b8 (\u03c4))\n\u00b5\u0303(\u03c4)\n] .\nThus the minimizingZ is precisely the importance sampling estimate of the partition function in Equation 4."
        },
        {
            "heading": "3.2.2 c\u03b8 optimizes the IRL objective",
            "text": "We return to the discriminator\u2019s loss as computed in Equation 8, and consider the derivative with respect to the parameters\u03b8 . We will show that this is exactly the same as the derivative of the IRL objective.\nOnly the second and fourth terms in the sum depend on\u03b8 . When we differentiate those terms we obtain:\n\u2202\u03b8Ldiscriminator(D\u03b8 ) = E\u03c4\u223cp[\u2202\u03b8 c\u03b8 (\u03c4)]\u2212E\u03c4\u223c\u00b5\n[ 1 Z exp(\u2212c\u03b8 (\u03c4))\u2202\u03b8 c\u03b8 (\u03c4)\n\u00b5\u0303(\u03c4)\n]\nOn the other hand, when we differentiate the MaxEnt IRL objectiv , we obtain:\n\u2202\u03b8Lcost(\u03b8 ) = E\u03c4\u223cp[\u2202\u03b8 c\u03b8 (\u03c4)]+ \u2202\u03b8 log ( E\u03c4\u223c\u00b5 [ exp(\u2212c\u03b8 (\u03c4))\n\u00b5\u0303(\u03c4)\n])\n= E\u03c4\u223cp[\u2202\u03b8 c\u03b8 (\u03c4)]+ ( E\u03c4\u223c\u00b5 [ \u2212exp(\u2212c\u03b8 (\u03c4))\u2202\u03b8 c\u03b8 (\u03c4)\n\u00b5\u0303(\u03c4)\n]/ E\u03c4\u223c\u00b5 [ exp(\u2212c\u03b8 (\u03c4))\n\u00b5\u0303(\u03c4)\n])\n= E\u03c4\u223cp[\u2202\u03b8 c\u03b8 (\u03c4)]\u2212E\u03c4\u223c\u00b5\n[ 1 Z exp(\u2212c\u03b8 (\u03c4))\u2202\u03b8 c\u03b8 (\u03c4)\n\u00b5\u0303(\u03c4)\n]\n= \u2202\u03b8Ldiscriminator(D\u03b8 ).\nIn the third equality, we used the definition ofZ as an importance sampling estimate. Note that in the second equality, we have treated\u00b5\u0303(\u03c4) as a constant rather than as a quantity that depends on\u03b8 . This is because the IRL optimization is minimizing logZ = log\u2211\u03c4 exp(\u2212c\u03b8 (\u03c4)) and using\u00b5\u0303(\u03c4) as the weights for an importance sampling estimator ofZ. For this purpose we do not want to differentiate through the importance weights."
        },
        {
            "heading": "3.3 The generator optimizes the MaxEnt IRL objective",
            "text": "Finally, we compute the generator\u2019s loss:\nLgenerator(q) = E\u03c4\u223cq[log(1\u2212D(\u03c4))\u2212 log(D(\u03c4))]\n= E\u03c4\u223cq\n[ log\nq(\u03c4) \u00b5\u0303(\u03c4) \u2212 log 1 Z exp(\u2212c\u03b8 (\u03c4)) \u00b5\u0303(\u03c4)\n]\n= E\u03c4\u223cq[logq(\u03c4)+ logZ+ c\u03b8 (\u03c4)] = logZ+E\u03c4\u223cq[c\u03b8 (\u03c4)]+E\u03c4\u223cq[logq(\u03c4)] = logZ+Lsampler(q).\nThe term logZ is a parameter of the discriminator that is held fixed while optimizing the generator, this loss is exactly equivalent the sampler loss from MaxEntIRL, defined in Equation 2."
        },
        {
            "heading": "3.4 Discussion",
            "text": "There are many apparent differences between MaxEnt IRL and the GAN optimization problem. But, we have shown that after making a single key change\u2014using a generatorq(\u03c4) for which densities can be evaluated efficiently, and incorporating this information into the discriminator in a natural way\u2014generative adversarial networks can be viewed as a sample-based algorithm for the MaxEnt IRL problem. By connecting GANs to the empirical literatureon inverse reinforcement learning [7], this demonstrates that GAN training can improve the qualityof samples even when the generator\u2019s density can be evaluated exactly. By generalizing this connection, we can derive a new adversarial training strategy for energy-based models, which we discuss in the next section."
        },
        {
            "heading": "4 GANs for training EBMs",
            "text": "Now that we have highlighted the connection between GANs andgui ed cost learning, the application of GANs to EBMs follows directly. As discussed in Section 2.2, the primary challenge in training EBMs is estimating the partition function, which is done by approximately sampling from the distribution induced by the energyE\u03b8 . Two recent papers have proposed to use adversarial training to derive fast estimates of the partition function [12, 25]. In particular, these methods alternate between training a generator to produce samples with minimal energyE\u03b8 (x), and optimizing the parameters of the energy function using the samples to estimate the partition function.\nWhen the density of the generator is available, however, we can derive an unbiased estimate of the partition function as\nZ = Ex\u223c\u00b5 [ exp(\u2212E\u03b8 (x)) 1 2 p\u0303(x)+ 1 2q(x) ]\nwhere\u00b5 denotes an equal mixture of generated and real data points,q(x) denotes the density under the generator, and\u0303p(x) denotes an estimate for the data density.\nThis gives a loss function\nLenergy(\u03b8 ) = Ex\u223cp[\u2212 logp\u03b8 (x)]\n= Ex\u223cp[\u2212E\u03b8 (x)]\u2212 log ( Ex\u223c\u00b5 [ exp(\u2212E\u03b8 (x)) 1 2 p\u0303(x)+ 1 2q(x) ]) .\nAs before, the generator is updated to minimize energy and maximize entropy:\nLgenerator(q) = Ex\u223cq[E\u03b8 (x)]+Ex\u223cq[logq(x)]\nIf we set p\u0303(x) = p\u03b8 (x), the resulting model is a special case of a GAN which is straightforward to implement. The discriminator\u2019s output is\u03c3(E\u03b8 (x)\u2212 logq(x)), where\u03c3 is a sigmoid with a trainable bias. The discriminator\u2019s loss is the log probability and the generator\u2019s loss is the discriminator\u2019s log odds, as defined in Section 2.1.\nKim & Bengio proposed a similar energy-based model for generative image modeling, but did not assume they could compute the generator\u2019s density [12]. As are ult, they do not use importance weights, and work with a biased estimator of the partition fuction which converges to the true partition function when the generator correctly samples from the energy-based model. In contrast, by using the generator density, we can get an unbiased estimate of the partition function that does not rely on any assumptions about the generator. Thus, even if the generator cannot learn to sample exactly from the data distribution, our training procedureis consistent.\nZhao et al. also proposed an energy-based GAN model with an autoencoder discriminator where the energy is given by the mean-squared error between the data ex mple (generated or real) and the discriminator\u2019s reconstruction [25]. The energy functions optimized with a margin loss, and the generator is trained to minimize energy. This method also did not use the form of discriminator presented above. An interesting direction for future explorati n is to consider combining the GAN training algorithm discussed here with an objective other tan log-likelihood, such as one used with EBMs [14] or differentf -divergences used with GANs [17]."
        },
        {
            "heading": "5 Related Work",
            "text": "Ho et al. [10, 9] previously presented a GAN-like algorithm for imitation learning, where the goal is to recover a policy that matches the expert demonstrations. The proposed algorithm, called generative adversarial imitation learning (GAIL), has an adversarial structure. The analysis in this paper provides additional insight into what GAIL is doing. As discussed above, GANs are optimizing the same objective as MaxEnt IRL. Thus, the GAIL policy is being trained to optimize a cost learned through MaxEnt IRL. Unlike guided cost learning [7], however, Ho & Ermon use the typical unconstrained form of the discriminator [9] and do not use the generator\u2019s density. In this case, the cost function remains implicit within the discriminator and cannot be recovered. Hence, in GAIL, the discriminator is discarded and the policy is the end result.\nBachman & Precup [1] suggested that data generation can be conv rted into a sequential decisionmaking problem and solved with a reinforcement learning method. Several recent works have proposed methods for merging maximum likelihood objectives and known reward functions for training sequential language generation models and rely on surrogate reward function such as BLEU score or edit distance [20, 16, 2]. In this work, we assume that the rewa d function is unknown.\nYu et al. proposed to learn a cost function for sequential data generation using GANs, where the cost is defined as the probability of the discriminator classifying the generated sequence as coming from the data distribution [24]. The discriminator does not takedvantage of the policy\u2019s density values, despite the fact that they are known (and are used during pre-training). Their experiments also find\nthat max-likelihood pre-training is crucial for good performance, suggesting that recurrent generators that can\u2019t afford such pre-training (e.g. because theydon\u2019t have densities) are less practical to train.\nPfau & Vinyals drew a connection between the optimization problems in GANs and actor-critic methods in reinforcement learning, suggesting how ideas for stabilizing training in one domain could be beneficial for the other [19]. As the authors point out, these optimization tricks could also be useful for imitation learning algorithms with the same two-level optimization structure."
        },
        {
            "heading": "6 Discussion",
            "text": "In this work, we showed an equivalence between generative adrsarial modeling and an algorithm for performing maximum entropy inverse reinforcement learning. Our derivation used a special form of discriminator that leverages likelihood values from the generator, leading to an unbiased estimate of the underlying energy function. A natural direct on for future work is to experiment with combining deep generators that can provide densities,such as autoregressive models [13, 22] or models that use invertible transformations [6], with generative adversarial modeling. Such an approach may provide more stable training, better generators, and wider applicability to discrete problems such as language.\nThis work also suggests a new algorithm for training energy-based models using generative adversarial networks, that trains a neural network model to sample from the distribution induced by the current energy. This method could reduce the computationalchal enges of existing MCMC-based solutions."
        },
        {
            "heading": "Acknowledgments",
            "text": "The authors would like to thank Ian Goodfellow and Joan Brunafor insightful discussions."
        }
    ],
    "year": 2016
}