{
    "abstractText": "We introduce a Deep Stochastic IOC1 RNN Encoderdecoder framework, DESIRE, for the task of future predictions of multiple interacting agents in dynamic scenes. DESIRE effectively predicts future locations of objects in multiple scenes by 1) accounting for the multi-modal nature of the future prediction (i.e., given the same context, future may vary), 2) foreseeing the potential future outcomes and make a strategic prediction based on that, and 3) reasoning not only from the past motion history, but also from the scene context as well as the interactions among the agents. DESIRE achieves these in a single end-to-end trainable neural network model, while being computationally efficient. The model first obtains a diverse set of hypothetical future prediction samples employing a conditional variational autoencoder, which are ranked and refined by the following RNN scoring-regression module. Samples are scored by accounting for accumulated future rewards, which enables better long-term strategic decisions similar to IOC frameworks. An RNN scene context fusion module jointly captures past motion histories, the semantic scene context and interactions among multiple agents. A feedback mechanism iterates over the ranking and refinement to further boost the prediction accuracy. We evaluate our model on two publicly available datasets: KITTI and Stanford Drone Dataset. Our experiments show that the proposed model significantly improves the prediction accuracy compared to other baseline methods.",
    "authors": [
        {
            "affiliations": [],
            "name": "Namhoon Lee"
        },
        {
            "affiliations": [],
            "name": "Wongun Choi"
        },
        {
            "affiliations": [],
            "name": "Paul Vernaza"
        },
        {
            "affiliations": [],
            "name": "Christopher B. Choy"
        },
        {
            "affiliations": [],
            "name": "Philip H. S. Torr"
        },
        {
            "affiliations": [],
            "name": "Manmohan Chandraker"
        }
    ],
    "id": "SP:97429525089ca6bf3b4571274667c92a1677b7d9",
    "references": [
        {
            "authors": [
                "P. Abbeel",
                "A.Y. Ng"
            ],
            "title": "Apprenticeship learning via inverse reinforcement learning",
            "venue": "In Proceedings of the twenty-first international conference on Machine learning,",
            "year": 2004
        },
        {
            "authors": [
                "H. Akaike"
            ],
            "title": "Fitting autoregressive models for prediction",
            "venue": "Annals of the institute of Statistical Mathematics,",
            "year": 1969
        },
        {
            "authors": [
                "A. Alahi",
                "K. Goel",
                "V. Ramanathan",
                "A. Robicquet",
                "L. Fei-Fei",
                "S. Savarese"
            ],
            "title": "Social lstm: Human trajectory prediction in crowded spaces",
            "venue": "In The IEEE Conference on Computer Vision and Pattern Recognition (CVPR),",
            "year": 2016
        },
        {
            "authors": [
                "D. Bahdanau",
                "K. Cho",
                "Y. Bengio"
            ],
            "title": "Neural machine translation by jointly learning to align and translate",
            "venue": "arXiv preprint arXiv:1409.0473,",
            "year": 2014
        },
        {
            "authors": [
                "L. Ballan",
                "F. Castaldo",
                "A. Alahi",
                "F. Palmieri",
                "S. Savarese"
            ],
            "title": "Knowledge transfer for scene-specific motion prediction",
            "venue": "arXiv preprint arXiv:1603.06987,",
            "year": 2016
        },
        {
            "authors": [
                "L. Busoniu",
                "R. Babuska",
                "B. De Schutter"
            ],
            "title": "A comprehensive survey of multiagent reinforcement learning",
            "venue": "IEEE Transactions on Systems, Man, And Cybernetics-Part C: Applications and Reviews,",
            "year": 2008
        },
        {
            "authors": [
                "K. Cho",
                "B. Van Merri\u00ebnboer",
                "C. Gulcehre",
                "D. Bahdanau",
                "F. Bougares",
                "H. Schwenk",
                "Y. Bengio"
            ],
            "title": "Learning phrase representations using rnn encoder-decoder for statistical machine translation",
            "venue": "arXiv preprint arXiv:1406.1078,",
            "year": 2014
        },
        {
            "authors": [
                "J. Chung",
                "C. Gulcehre",
                "K. Cho",
                "Y. Bengio"
            ],
            "title": "Empirical evaluation of gated recurrent neural networks on sequence modeling",
            "venue": "arXiv preprint arXiv:1412.3555,",
            "year": 2014
        },
        {
            "authors": [
                "J. Donahue",
                "L. Anne Hendricks",
                "S. Guadarrama",
                "M. Rohrbach",
                "S. Venugopalan",
                "K. Saenko",
                "T. Darrell"
            ],
            "title": "Long-term recurrent convolutional networks for visual recognition and description",
            "venue": "In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition,",
            "year": 2015
        },
        {
            "authors": [
                "A.D. Dragan",
                "N.D. Ratliff",
                "S.S. Srinivasa"
            ],
            "title": "Manipulation planning with goal sets using constrained trajectory optimization",
            "venue": "In Robotics and Automation (ICRA),",
            "year": 2011
        },
        {
            "authors": [
                "C. Finn",
                "S. Levine",
                "P. Abbeel"
            ],
            "title": "Guided cost learning: Deep inverse optimal control via policy optimization",
            "venue": "arXiv preprint arXiv:1603.00448,",
            "year": 2016
        },
        {
            "authors": [
                "A. Geiger",
                "P. Lenz",
                "C. Stiller",
                "R. Urtasun"
            ],
            "title": "Vision meets robotics: The kitti dataset",
            "venue": "International Journal of Robotics Research (IJRR),",
            "year": 2013
        },
        {
            "authors": [
                "A. Graves",
                "A.-r. Mohamed",
                "G. Hinton"
            ],
            "title": "Speech recognition with deep recurrent neural networks",
            "venue": "IEEE international conference on acoustics, speech and signal processing,",
            "year": 2013
        },
        {
            "authors": [
                "D. Helbing",
                "P. Molnar"
            ],
            "title": "Social force model for pedestrian dynamics",
            "venue": "Physical review E,",
            "year": 1995
        },
        {
            "authors": [
                "S. Hochreiter",
                "J. Schmidhuber"
            ],
            "title": "Long short-term memory",
            "venue": "Neural computation,",
            "year": 1997
        },
        {
            "authors": [
                "J. Hu",
                "M.P. Wellman"
            ],
            "title": "Nash q-learning for general-sum stochastic games",
            "venue": "Journal of machine learning research,",
            "year": 2003
        },
        {
            "authors": [
                "A. Jain",
                "A. Singh",
                "H.S. Koppula",
                "S. Soh",
                "A. Saxena"
            ],
            "title": "Recurrent neural networks for driver activity anticipation via sensory-fusion architecture",
            "venue": "In International Conference on Robotics and Automation (ICRA),",
            "year": 2016
        },
        {
            "authors": [
                "R.E. Kalman"
            ],
            "title": "A new approach to linear filtering and prediction problems",
            "venue": "Journal of basic Engineering,",
            "year": 1960
        },
        {
            "authors": [
                "A. Karpathy",
                "L. Fei-Fei"
            ],
            "title": "Deep visual-semantic alignments for generating image descriptions",
            "venue": "In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition,",
            "year": 2015
        },
        {
            "authors": [
                "D. Kingma",
                "J. Ba"
            ],
            "title": "Adam: A method for stochastic optimization",
            "venue": "arXiv preprint arXiv:1412.6980,",
            "year": 2014
        },
        {
            "authors": [
                "D.P. Kingma",
                "S. Mohamed",
                "D.J. Rezende",
                "M. Welling"
            ],
            "title": "Semi-supervised learning with deep generative models",
            "venue": "In Advances in Neural Information Processing Systems,",
            "year": 2014
        },
        {
            "authors": [
                "D.P. Kingma",
                "M. Welling"
            ],
            "title": "Auto-encoding variational bayes",
            "venue": "arXiv preprint arXiv:1312.6114,",
            "year": 2013
        },
        {
            "authors": [
                "K.M. Kitani",
                "B.D. Ziebart",
                "J.A. Bagnell",
                "M. Hebert"
            ],
            "title": "Activity forecasting",
            "venue": "In European Conference on Computer Vision,",
            "year": 2012
        },
        {
            "authors": [
                "J.F.P. Kooij",
                "N. Schneider",
                "F. Flohr",
                "D.M. Gavrila"
            ],
            "title": "Context-based pedestrian path prediction",
            "venue": "In European Conference on Computer Vision,",
            "year": 2014
        },
        {
            "authors": [
                "H. Kretzschmar",
                "M. Kuderer",
                "W. Burgard"
            ],
            "title": "Learning to predict trajectories of cooperatively navigating agents",
            "venue": "In 2014 IEEE International Conference on Robotics and Automation (ICRA),",
            "year": 2014
        },
        {
            "authors": [
                "N. Lee",
                "K.M. Kitani"
            ],
            "title": "Predicting wide receiver trajectories in american football",
            "venue": "IEEE Winter Conference on Applications of Computer Vision (WACV),",
            "year": 2016
        },
        {
            "authors": [
                "J. Mainprice",
                "R. Hayne",
                "D. Berenson"
            ],
            "title": "Goal set inverse optimal control and iterative re-planning for predicting human reaching motions in shared workspaces",
            "venue": "arXiv preprint arXiv:1606.02111,",
            "year": 2016
        },
        {
            "authors": [
                "P. McCullagh",
                "J.A. Nelder"
            ],
            "title": "Generalized linear models, volume 37",
            "venue": "CRC press,",
            "year": 1989
        },
        {
            "authors": [
                "H.S. Park",
                "J.-J. Hwang",
                "Y. Niu",
                "J. Shi"
            ],
            "title": "Egocentric future localization",
            "year": 2016
        },
        {
            "authors": [
                "S. Pellegrini",
                "A. Ess",
                "K. Schindler",
                "L. Van Gool"
            ],
            "title": "You\u2019ll never walk alone: Modeling social behavior for multi-target tracking",
            "venue": "IEEE 12th International Conference on Computer Vision,",
            "year": 2009
        },
        {
            "authors": [
                "M.B. Priestley"
            ],
            "title": "Spectral analysis and time series",
            "year": 1981
        },
        {
            "authors": [
                "J. Qui\u00f1onero-Candela",
                "C.E. Rasmussen"
            ],
            "title": "A unifying view of sparse approximate gaussian process regression",
            "venue": "Journal of Machine Learning Research,",
            "year": 2005
        },
        {
            "authors": [
                "C.E. Rasmussen"
            ],
            "title": "Gaussian processes for machine learning",
            "year": 2006
        },
        {
            "authors": [
                "D.J. Rezende",
                "S. Mohamed",
                "D. Wierstra"
            ],
            "title": "Stochastic backpropagation and approximate inference in deep generative models",
            "venue": "arXiv preprint arXiv:1401.4082,",
            "year": 2014
        },
        {
            "authors": [
                "A. Robicquet",
                "A. Sadeghian",
                "A. Alahi",
                "S. Savarese"
            ],
            "title": "Learning social etiquette: Human trajectory understanding in crowded scenes",
            "venue": "In European Conference on Computer Vision,",
            "year": 2016
        },
        {
            "authors": [
                "R. Salakhutdinov",
                "G.E. Hinton"
            ],
            "title": "Deep boltzmann machines",
            "venue": "In AISTATS,",
            "year": 2009
        },
        {
            "authors": [
                "S. Shalev-Shwartz",
                "N. Ben-Zrihem",
                "A. Cohen",
                "A. Shashua"
            ],
            "title": "Long-term planning by short-term prediction",
            "venue": "arXiv preprint arXiv:1602.01580,",
            "year": 2016
        },
        {
            "authors": [
                "Y. Shoham",
                "K. Leyton-Brown"
            ],
            "title": "Multiagent systems: Algorithmic, game-theoretic, and logical foundations",
            "year": 2008
        },
        {
            "authors": [
                "Y. Shoham",
                "R. Powers",
                "T. Grenager"
            ],
            "title": "If multi-agent learning is the answer, what is the question",
            "venue": "Artificial Intelligence,",
            "year": 2007
        },
        {
            "authors": [
                "K. Sohn",
                "H. Lee",
                "X. Yan"
            ],
            "title": "Learning structured output representation using deep conditional generative models",
            "venue": "In Advances in Neural Information Processing Systems,",
            "year": 2015
        },
        {
            "authors": [
                "I. Sutskever",
                "O. Vinyals",
                "Q.V. Le"
            ],
            "title": "Sequence to sequence learning with neural networks",
            "venue": "In Advances in neural information processing systems,",
            "year": 2014
        },
        {
            "authors": [
                "R.S. Sutton",
                "A.G. Barto"
            ],
            "title": "Reinforcement learning: An introduction, volume 1",
            "venue": "MIT press Cambridge,",
            "year": 1998
        },
        {
            "authors": [
                "E. Thibodeau-Laufer",
                "G. Alain",
                "J. Yosinski"
            ],
            "title": "Deep generative stochastic networks trainable by backprop",
            "year": 2014
        },
        {
            "authors": [
                "C. Vondrick",
                "H. Pirsiavash",
                "A. Torralba"
            ],
            "title": "Anticipating visual representations from unlabeled video. 2016",
            "year": 2016
        },
        {
            "authors": [
                "J. Walker",
                "C. Doersch",
                "A. Gupta",
                "M. Hebert"
            ],
            "title": "An uncertain future: Forecasting from static images using variational autoencoders",
            "venue": "In European Conference on Computer Vision,",
            "year": 2016
        },
        {
            "authors": [
                "J. Walker",
                "A. Gupta",
                "M. Hebert"
            ],
            "title": "Patch to the future: Unsupervised visual prediction",
            "venue": "IEEE Conference on Computer Vision and Pattern Recognition,",
            "year": 2014
        },
        {
            "authors": [
                "J.M. Wang",
                "D.J. Fleet",
                "A. Hertzmann"
            ],
            "title": "Gaussian process dynamical models for human motion",
            "venue": "IEEE transactions on pattern analysis and machine intelligence,",
            "year": 2008
        },
        {
            "authors": [
                "C.K. Williams"
            ],
            "title": "Prediction with gaussian processes: From linear regression to linear prediction and beyond. In Learning in graphical models, pages 599\u2013621",
            "year": 1998
        },
        {
            "authors": [
                "M. Wulfmeier",
                "D.Z. Wang",
                "I. Posner"
            ],
            "title": "Watch this: Scalable cost-function learning for path planning in urban environments",
            "venue": "arXiv preprint arXiv:1607.02329,",
            "year": 2016
        },
        {
            "authors": [
                "K. Xu",
                "J. Ba",
                "R. Kiros",
                "K. Cho",
                "A. Courville",
                "R. Salakhutdinov",
                "R.S. Zemel",
                "Y. Bengio"
            ],
            "title": "Show, attend and tell: Neural image caption generation with visual attention",
            "venue": "arXiv preprint arXiv:1502.03044,",
            "year": 2015
        },
        {
            "authors": [
                "B.D. Ziebart",
                "A.L. Maas",
                "J.A. Bagnell",
                "A.K. Dey"
            ],
            "title": "Maximum entropy inverse reinforcement learning",
            "venue": "In AAAI,",
            "year": 2008
        }
    ],
    "sections": [
        {
            "heading": "1. Introduction",
            "text": "It is far better to foresee even without certainty than not to foresee at all.\nHenri Poincare\u0301 (Foundations of Science)\nConsidering the future as a consequence of a series of past events, a prediction entails reasoning about probable\n1IOC: Abbreviation for inverse optimal control, which will be more explained throughout the paper.\noutcomes based on past observations. But predicting the future in many computer vision tasks is inherently riddled with uncertainty (see Fig. 1). Imagine a busy traffic intersection, where such ambiguity is exacerbated by diverse interactions of automobiles, pedestrians and cyclists with each other, as well as with semantic elements such as lanes, crosswalks and traffic lights. Despite tremendous recent interest in future prediction [3, 5, 17, 23, 26, 45, 46], existing state-of-the-art produces outcomes that are either deterministic, or do not fully account for interactions, semantic context or long-term future rewards.\nIn contrast, we present DESIRE, a Deep Stochastic IOC RNN Encoder-decoder framework, to overcome those limitations. The key traits of DESIRE are its ability to simultaneously: (a) generate diverse hypotheses to reflect a distribution over plausible futures, (b) reason about interactions between multiple dynamic objects and the scene context, (c) rank and refine hypotheses with consideration of long-term future rewards (see Fig. 1). These objectives are cast within a deep learning framework.\nar X\niv :1\n70 4.\n04 39\n4v 1\n[ cs\n.C V\n] 1\n4 A\npr 2\n01 7\nWe model the scene as composed of semantic elements (such as roads and crosswalks) and dynamic participants or agents (such as cars and pedestrians). A static or moving observer is also considered as an instance of an agent. We formulate future prediction as determining the locations of agents at various instants in the future, relying solely on observations of the past states of the scene, in the form of agent trajectories and scene context derived from image-based features or other sensory data if available. The problem is posed in an optimization framework that maximizes the potential future reward of the prediction. Specifically, we propose the following novel mechanisms to realize the above advantages, also illustrated in Fig. 2: \u2022 Diverse Sample Generation: Sec. 3.1 presents a condi-\ntional variational auto-encoder (CVAE) framework [41] to learn a sampling model that, given observations of past trajectories, produces a diverse set of prediction hypotheses to capture the multimodality of the space of plausible futures. The CVAE introduces a latent variable to account for the ambiguity of the future, which is combined with a recurrent neural network (RNN) encoding of past trajectories, to generate hypotheses using another RNN. \u2022 IOC-based Ranking and Refinement: In Sec. 3.2, we propose a ranking module that determines the most likely hypotheses, while incorporating scene context and interactions. Since an optimal policy is hard to determine where multiple agents make strategic inter-dependent choices, the ranking objective is formulated to account for potential future rewards similar to inverse optimal control (IOC). This also ensures generalization to new situations further in the future, given limited training data. The module is trained in a multitask framework with a regression-based refinement of the predicted samples. In the testing phase, we iterate the above multiple times to obtain more accurate refinements of the future prediction. \u2022 Scene Context Fusion: Sec. 3.3 presents the Scene Context Fusion (SCF) layer that aggregates interactions between agents and the scene context encoded by a convolutional neural network (CNN). The fused embedding is channeled to the aforementioned RNN scoring module and allows to produce the rewards based on the contextual information.\nWhile DESIRE is a general framework that is applicable to any future prediction task, we demonstrate its utility in two applications \u2013 traffic scene understanding for autonomous driving and behavior prediction in aerial surveillance. Sec. 4 demonstrates outstanding accuracy for predicting the future locations of traffic participants in the KITTI raw dataset and pedestrians in the Stanford Drone dataset.\nTo summarize, this paper presents DESIRE, which is a deep learning based stochastic framework for time-profiled distant future prediction, with several attractive properties: \u2022 Scalability: The use of deep learning rather than hand-\ncrafted features enables end-to-end training and easy incor-\nporation of multiple cues arising from past motions, scene context and interactions between multiple agents. \u2022 Diversity: The stochastic output of a deep generative model (CVAE) is combined with an RNN encoding of past observations to generate multiple prediction hypotheses that hallucinate ambiguities and multimodalities inherent in future prediction. \u2022 Accuracy: The IOC-based framework accumulates longterm future rewards for sampled trajectories and the regression-based refinement module learns to estimate a deformation of the trajectory, enabling more accurate predictions further into the future."
        },
        {
            "heading": "2. Related Works",
            "text": "Classical methods Path prediction problems have been studied extensively with different approaches such as Kalman filters [18], linear regressions [29] to non-linear Gaussian Process regression models [49, 33, 34, 48], autoregressive models [2] and time-series analysis [32]. Such predictions suffice for scenarios with few interactions between the agent and the scene or other agents (like a flight monitoring system). In contrast, we propose methods for more complex environments such as surveillance for a crowd of pedestrians or traffic intersections, where the locomotion of individual agents is severely influenced by the scene context (e.g., drivable road or building) and the other agents (e.g., people or cars try to avoid colliding with the other). IOC for path prediction Kitani et al. recover human preferences (i.e., reward function) to forecast plausible paths for a pedestrian in [23] using inverse optimal control (IOC), or inverse reinforcement learning (IRL) [1, 52], while [26] adapt IOC and propose a dynamic reward function to address changes in environments for sequential path predictions. Combined with a deep neural network, deep IOC/IRL has been proposed to learn non-linear reward functions and showed promising results in robot control [11] and driving [50] tasks. However, one critical assumption made in IOC frameworks, which makes them hard to be applied to general path prediction tasks, is that the goal state or the destination of agent should be given a priori, whereby feasible paths must be found to the given destination from the planning or control point of view. A few approaches relaxed this assumption with so-called goal set [28, 10], but these goals are still limited to a target task space. Furthermore, a recovered cost function using IOC is inherently static, thus it is not suitable for time-profiled prediction tasks. Finally, past approaches do not incorporate interaction between agents, which is often a key constraint to the motion of multiple agents. In contrast, our methods are designed for more natural scenarios where agent goals are open-ended, unknown or time-varying and where agents interact with each other while dynamically adapting in anticipation of future behaviors. Future prediction Walker et al. [47] propose a visual pre-\ndiction framework with a data-driven unsupervised approach, but only on a static scene, while [5] learn scene-specific motion patterns and apply to novel scenes for motion prediction as a knowledge transfer. A method for future localization from egocentric perspective is also addressed successfully in [30]. But unlike our method, none of those can provide time-profiled predictions. Recently, a large dataset is collected in [36] to propose the concept of social sensitivity to improve forecasting models and the multi-target tracking task. However, their social force [14] based model has limited navigation styles represented merely using parameters of distance-based Gaussians.\nInteractions When modeling the behavior of an agent, it should also be taken into account that the dynamics of an agent not only depend on its own, but also on the behavior of others. Predicting the dynamics of multiple objects is also studied in [24, 25, 3, 31], to name a few. Recently, a novel pooling layer is presented by [3], where the hidden state of neighboring pedestrians are shared together to joinly reason across multiple people. Nonetheless, these models lack predictive capacity as they do not take into account scene context. In [24], a dynamic Bayesian network to capture situational awareness is proposed as a context cue for pedestrian path prediction, but the model is limited to orientations and distances of pedestrians to vehicles and the curbside. A large body of work in reinforcement learning, especially game theoretical generalizations of Markov Decision Processes (MDPs), addresses multi-agent cases such as minmax-Q learning [27] and Nash-Q learning [16]. However, as noted in [38], typically learning in multi-agent setting is inherently more complex than single agent setting [40, 39, 6].\nRNNs for sequence prediction Recurrent neural networks (RNNs) are natural generalizations of feedforward neural networks to sequences [42] and have achieved remarkable results in speech recognition [13], machine translation [4, 42, 7] and image captioning [19, 51, 9]. The power of RNNs for sequence-to-sequence modeling thus makes them a reasonable model of choice to learn to generate sequential future prediction outputs. Our approach is similar to [7] in making use of the encoder-decoder structure to embed a hidden representation for encoding and decoding variable length inputs and outputs. We choose to use gated recurrent units (GRUs) over long short-term memory units (LSTMs) [15] since the former is found to be simpler yet yields no degraded performance [8]. Despite the promise inherent in RNNs, however, only a few works have applied RNNs to behavior prediction tasks. Multiple LSTMs are used in [3] to jointly predict human trajectories, but their model is limited to producing fixed-length trajectories, whereas our model can produce variable-length ones. A Fusion-RNN that combines information from sensory streams to anticipate a driver\u2019s maneuver is proposed in [17], but again their model outputs deterministic and fixed-length predictions.\nDeep generative models Our work is also related to deep generative models [37, 35, 44], as we have a sample generation process that is built on a variational auto-encoder (VAE) [22] within the framework. Since our prediction model essentially performs posterior-based probabilistic inference where candidate samples are generated based on conditioning variables (i.e., past motions besides latent variables), we naturally extend our method to exploit a conditional variational auto-encoder (CVAE) [21, 41] during the sample generation process. Dense trajectories of pixels are predicted from a single image using CVAE in [46], while we focus on predicting long-term behaviors of multiple interacting agents in dynamic scenes.\nUnlike our framework, all aforementioned approaches lack either consideration of scene context, modeling of interaction with other agents or capabilities in producing continuous, time-profiled and long-term accurate predictions."
        },
        {
            "heading": "3. Method",
            "text": "We formulate the future prediction problem as an optimization process, where the objective is to learn the posterior distribution P (Y|X, I) of multiple agents\u2019 future trajectories Y = {Y1, Y2, .., Yn} given their past trajectories X = {X1, X2, .., Xn} and sensory input I where n is the number of agents. The future trajectory of an agent i is defined as Yi = {yi,t+1, yi,t+2, .., yi,t+\u03b4}, and the past trajectory is defined similarly as Xi = {xi,t\u2212\u03b9+1, xi,t\u2212\u03b9+2, .., xi,t}. Here, each element of a trajectory (e.g., yi,t) is a vector in R2 (or R3) representing the coordinates of agent i at time t, and \u03b4 and \u03b9 refer to the maximum length of time steps for future and past respectively. Since direct optimization of continuous and high dimensional Y is not feasible, we design our method to first sample a diverse set of future predictions and assign a probabilistic score to each of the samples to approximate P (Y|X, I). In this section, we describe the details of DESIRE (Fig. 2) in the following structure: Sample Generation Module (Sec. 3.1), Ranking and Refinement Module (Sec. 3.2), and Scene Context Fusion (Sec. 3.3)."
        },
        {
            "heading": "3.1. Diverse Sample Generation with CVAE",
            "text": "Future prediction can be inherently ambiguous and has uncertainties as multiple plausible scenarios can be explained under the same past situation (e.g., a vehicle heading toward an intersection can make different turns as seen in Fig. 1). Thus, learning a deterministic function f that directly maps {X, I} to Y will under-represent potential prediction space and easily over-fit to training data. Moreover, a naively trained network with a simple loss will produce predictions that average out all possible outcomes.\nIn order to tackle the uncertainty, we adopt a deep generative model, conditional variational auto-encoder (CVAE) [41], inside of DESIRE framework. CVAE is a generative model that can learn the distribution P (Yi|Xi) of\nthe output Yi conditioned on the input Xi by introducing a stochastic latent variable zi2. It is composed of multiple neural networks, such as recognition networkQ\u03c6(zi|Yi, Xi), (conditional) prior network P\u03bd(zi|Xi), and generation network P\u03b8(Yi|Xi, zi). Here, \u03b8, \u03c6, \u03bd denote the parameters of corresponding networks. The prior of the latent variables zi is modulated by the input Xi, however, this can be relaxed to make the latent variables statistically independent of input variables, i.e., P\u03bd(zi|Xi) = P\u03bd(zi) [21, 41]. Essentially, a CVAE introduces stochastic latent variables zi that are learned to encode a diverse set of predictions Yi given input Xi, making it suitable for modeling one-to-many mapping. During training, Q\u03c6(zi|Yi, Xi) is learned such that it gives higher probability to zi that is likely to produce a reconstruction Y\u0302i close to actual prediction given the full context Xi and Yi. At test time zi is sampled randomly from the prior distribution and decoded through the decoder network to produce a prediction hypothesis. This enables probabilistic inference which serves to handle multi-modalities in the prediction space. Train phase: Firstly, the past and future trajectories of an agent i, Xi and Yi respectively, are encoded through two RNN encoders with separate set of parameters (i.e., RNN Encoder1 and RNN Encoder2 in Fig. 2). The resulting two encodings,HXi andHYi , are concatenated and passed through one fully connected (fc) layer with a non-linear activation (e.g., relu). Two side-by-side fc layers are followed to produce both the mean \u00b5zi and the standard deviation \u03c3zi over zi. The distribution of zi is modeled as a Gaussian distribution (i.e., zi \u223c Q\u03c6(zi|Xi, Yi) = N (\u00b5zi , \u03c3zi)) and is regularized by theKL divergence against a prior distribution P\u03bd(zi) := N (0, I) during the training. Upon successful training, the target distribution is learned in the latent vari-\n2Notice that we learn the distribution independently over different agents in this step. Interaction between agents is considered in Sec. 3.2.\nable zi, which allows one to draw a random sample zi from a Gaussian distribution to reconstruct Yi at test time. Since back-propagation is not possible through random sampling, we adopt the standard reparameterization trick [22] to make it differentiable.\nIn order to model P\u03b8(Yi|Xi, zi), zi is combined with Xi as follows. The sampled latent variable zi is passed to one fc layer to match the dimension ofHXi that is followed by a softmax layer, producing \u03b2(zi). Then that is combined with the encodings of past trajectoriesHXi through a masking operation (i.e., element-wise multiplication). One can interpret this as a guided drop out where the guidance \u03b2 is derived from the full context of individual trajectory during the training phase, while it is randomly drawn from Xi, Yi agnostic prior distribution z(k)i \u223c P\u03bd(zi) in the testing phase. Finally, the following RNN decoder (i.e., RNN Decoder1 in Fig. 2) takes the output of the previous step,HXi \u03b2(z (k) i ), and generates K number of future prediction samples, i.e., Y\u0302i (1) , Y\u0302i (2) , .., Y\u0302i (K) .\nThere are two loss terms in training the CVAE-based RNN encoder-decoder.\n\u2022 Reconstruction Loss: `Recon = 1K \u2211 k \u2016Yi \u2212 Y\u0302i (k) \u2016. This\nloss measures how far the generated samples are from the actual ground truth. \u2022 KLD Loss: `KLD = DKL(Q\u03c6(zi|Yi, Xi)\u2016P\u03bd(zi)). This regularization loss measures how close the sampling distribution at test time is to the distribution of latent variable that we learn during training.\nTest phase: At test time, the encodings of future trajectories HYi are not available, thus the encodings of past trajectories HXi are combined with multiple random samples of latent variable z(k)i drawn from the prior z (k) i \u223c P\u03bd(zi). Similar to the training phase,HXi \u03b2(z (k) i ) is passed to the following\nRNN decoder (i.e., RNN Decoder1 in Fig. 2) to generate a diverse set of prediction hypotheses. Further details: For both train and test phases, we pass trajectories through a temporal convolution layer before encoding to encourage the network to learn the concept of velocity from adjacent frames before getting passed into RNN encoders. Also, RNNs are implemented using gated recurrent units (GRU) [7] to learn long-term dependencies, yet they can be easily replaced with other popular RNNs like long short-term memory units (LSTM) [15]. In summary, this sample generation module produces a set of diverse hypotheses critical to capturing the multimodality of the prediction task, through a effective combination of CVAE and RNN encoder-decoder. Unlike [46], where CVAE is used to predict for short-term visual motion from a single image, our CVAE module generates diverse set of future trajectories based on a past trajectory."
        },
        {
            "heading": "3.2. IOC-based Ranking and Refinement",
            "text": "Predicting a distant future can be far more challenging than predicting one close by. In order to tackle this, we adopt the concept of decision-making process in reinforcement learning (RL) where an agent is trained to choose its actions that maximizes long-term rewards to achieve its goal [43]. Instead of designing a reward function manually, however, IOC [50, 11] learns an unknown reward function. Inspired by this, we design an RNN model that assigns rewards to each prediction hypothesis Y\u0302i (k)\nand measures their goodness s(k)i based on the accumulated long-term rewards. Thereafter, we also directly refine prediction hypotheses by learning displacements4Y\u0302i (k)\nto the actual prediction through another fc layer. Lastly, the module receives iterative feedbacks from regressed predictions and keeps adjusting so that it produces precise predictions at the end. The model is illustrated in the right side of Fig. 2. During the process, we combine 1) past motion history through the embedding vectorHX, 2) semantic scene context through a CNN with parameters \u03c1, and 3) interaction among multiple agents by using interaction features (Sec. 3.3). Notice that unlike typical robotics applications [50, 11], we do not assume that the goal (final destination) is known or the dynamics of the agents are given. Our model learns the agents dynamics as well as the scene context in a coherent framework. Learning to score: For an agent i, there are K number of samples (i.e., Y\u0302 (1)i , Y\u0302 (2) i , .., Y\u0302 (K) i ) that are generated by our CVAE sampler. Let the score s of individual prediction hypothesis Y\u0302 (k)i for the agent i be defined as follows,\ns(Y\u0302 (k) i ; I,X, Y\u0302 (\u2200) j\\i) = T\u2211 t=1 \u03c8(y\u0302 (k) i,t ; I,X, Y\u0302 (\u2200) \u03c4<t), (1)\nwhere Y\u0302(\u2200)j\\i is the prediction samples of other agents (i.e., \u2200j, where j 6= i), y\u0302(k)i,t is the kth prediction sample of an\nagent i at time t, Y\u0302(\u2200)\u03c4<t is all the prediction samples until a time-step t, T is the maximum prediction length, and \u03c8 is the reward function that assigns a reward value at each time-step. \u03c8 is implemented as an fc layer that is connected to the hidden vector of RNN cell at each time step. We share the parameters of the fc layer over all the time steps (each RNN cell outputs the hidden state of the same dimension). Therefore, the score s is accumulated rewards over time, accounting for the entire future rewards being assigned to each hypothesis. This enables our model to make a strategic decision by allowing us to rank samples as in other samplingbased IOC frameworks [11]. In addition, the reward function \u03c8 incorporates both scene context I as well as the interaction between agents (see Sec. 3.3). Learning to refine: Alongside the scores, our model also estimates a regression vector4Y\u0302 (k)i that refines each prediction sample Y\u0302 (k)i . The regression vector for each agent i is obtained with the regression function \u03b7 defined as follows,\n4Y\u0302 (k)i = \u03b7(Y\u0302 (k) i ; I,X, Y\u0302 (\u2200) j\\i). (2)\nRepresented as parameters of a neural network, the regression function \u03b7 accumulates both scene contexts and all other agents dynamics from the past to entire future frames, and estimates the best displacement vector 4Y\u0302 (k)i over entire time-horizon T . Similarly to the score s, it accounts for what happens in the future both in terms of scene context and interactions among dynamic agents to produce the output. We implement \u03b7 as another fc layer that is connected to the last hidden vector of the RNN which outputsM\u00d7T dimensional vector. M = 2 (or 3) is the dimension of the location state. Iterative feedback: Using the displacement vector4Y\u0302 (k)i , we iteratively refine the prediction hypothesis Y\u0302 (k)i . After each cycle, Y\u0302 (k)i is updated by Y\u0302 (k) i +4Y\u0302 (k) i , and fed into the IOC module. This process is similar to the gradient descent optimization of Y\u0302i over the score function s, but it does not require to compute the gradient over RNN which can be very unstable due to the recurrent structure (i.e., vanishing or exploding gradient). We observe that iterative refinement indeed improves the quality of prediction samples in the experiments (see Fig. 4 and Fig. 5). Losses: There are two loss terms in training the IOC ranking and refinement module. \u2022 Cross-entropy Loss: `CE = H(p, q) of which the tar-\nget distribution q is obtained by softmax(\u2212d(Yi, Y\u0302 (k)i )), where d(Yi, Y\u0302 (k) i ) = max \u2016Y\u0302 (k) i \u2212 Yi\u2016.\n\u2022 Regression Loss: `Reg = 1K \u2211 k \u2016Yi \u2212 Y\u0302i (k) \u22124Y\u0302i (k) \u2016\nFinally, the total loss of the entire network is defined as a multi-task loss as follows, where N is the number of agents in one batch.\n`Total = 1\nN \u2211 i\u2208N `Recon + `KLD + `CE + `Reg (3)"
        },
        {
            "heading": "3.3. Scene Context Fusion",
            "text": "As discussed in the previous section, our ranking and refinement module relies on the hidden representation of the shared RNN module. Thus, it is important that the RNN must contain the information about 1) individual past motion context, 2) semantic scene context and 3) the interaction between multiple agents, in order to provide proper hidden representations that can score and refine a prediction Y\u0302 (k)i .\nWe achieve the goal by having an RNN that takes following input xt at each time step:\nxt = [ \u03b3(v\u0302i,t), p(y\u0302i,t; \u03c1(I)), r(y\u0302i,t; y\u0302j\\i,t,hY\u0302j\\i) ] (4)\nwhere v\u0302i,t is a velocity of Y\u0302 (k) i at t, \u03b3 is a fc layer with a ReLU activation that maps the velocity to a high dimensional representation space, p(y\u0302i,t; \u03c1(I)) is a pooling operation that pools the CNN feature \u03c1(I) at the location y\u0302i,t, r(y\u0302i,t; y\u0302j\\i,t,hY\u0302j\\i) is the interaction feature computed by a fusion layer that spatially aggregates other agents hidden vectors, similar to SocialPooling (SP) layer [3]. The embedding vectorHXi (the output of the RNN Encoder1 in Fig. 2) is shared as the initial hidden state of the RNN, in order to provide the individual past motion context. We share this embedding with the CVAE module since both require the same information to be embedded in the vector. Interaction Feature: We implement a spatial grid based pooling layer similar to SP layer [3]. For each sample k of an agent i at t, we define spatial grid cells centered at y\u0302(k)i,t . Over each grid cell g, we pool the hidden representation of all the other agents\u2019 samples that are within the spatial cell, \u2200j 6= i,\u2200k, y\u0302(k)j,t \u2208 g. Instead of using the max pooling operation with rectangular grids, we adopt log-polar grids with an average pooling. Combined with CNN features, the SCF module provides the RNN decoder with both static and dynamic scene information. It learns consistency between semantics of agents and scenes for reliable prediction."
        },
        {
            "heading": "3.4. Characteristics of DESIRE",
            "text": "This section highlights particularly distinctive features of DESIRE that naturally enable higher accuracy and reliability. \u2022 The framework is based on deep neural network and is\ntrainable end-to-end, rather than relying on hand-crafted parametric representation and interactions terms. Trajectories of each agent are represented using RNN encoders and are combined together through a fusion layer within the architecture. Scene context is represented through CNN and is not solely restricted to images (i.e., can handle nonvisual sensors too). Overall, the algorithm is scalable and flexible. \u2022 CVAE is combined with RNN encodings to generate stochastic prediction hypothesis, which handles ambiguities and multimodalities inherent in future prediction. \u2022 A novel RNN module coherently integrates multiple cues that have critical influence on behavior prediction such as dynamics of all neighboring agents and scene semantics. \u2022 An IOC framework is used to train the trajectory ranking objective by measuring potential long-term future rewards. This makes the model less reactive, and enables more accurate predictions further into the future. \u2022 A regression vector is learned to refine trajectories and an iterative feedback mechanism sequentially adjusts the predicted behavior, resulting in more accurate predictions."
        },
        {
            "heading": "4. Experiments",
            "text": ""
        },
        {
            "heading": "4.1. Datasets",
            "text": "KITTI Raw Data [12]: The dataset provides images of driving scenes and Velodyne 3D laser scan along with calibration information between cameras and sensors. To prepare data examples (i.e., X,Y, I), we performed the following: As the dataset does not provide semantic labels for 3D points (which we need for scene context), we first perform semantic segmentations of images and project Velodyne laser scans onto the image plane using the provided camera matrix to label 3D points. The semantically labeled 3D points are then registered into the world coordinates using GPS-IMU tags. Finally we create top-down view feature maps I of size H \u00d7W \u00d7 C (H,W : size of crop and C: number of classes for scene elements, e.g., road, sidewalk, and vegitation shown as red, blue and green color in Fig. 6.). I is cropped with respect to the view point of the camera to simulate actual driving scenario (H,W = 80m and the size of pixel is 0.5m. The camera is located at the left-center.). Since laser scans on dynamic objects generate traces during registration, we remove moving objects and only use static scene elements. The trajectories X,Y are generated by extracting the center locations of the 3D tracklets and registering them in the world coordinates. We use all annotated videos from Road and City scenes for our experiments and generate approximately 2,500 training examples.\n0.0 0.2 0.4 0.6 0.8 1.0 Top K ratio 0.1\n0.2\n0.3\nM ax\nim um\nM\nStanford Drone Dataset [36]: The dataset contains a large volume of aerial videos captured in a university campus using a drone. There are various classes of dynamic objects interacting with each other, often in the form of high density crowds. Except for less stabilized cameras and lost labels, we used all videos to create examples to train/test our model, yielding approximately 16, 000 examples. Note that we directly use raw images to extract visual features, rather than semantically labeled feature maps. We resize the images by 1/5 in following experiments to avoid memory overhead."
        },
        {
            "heading": "4.2. Evaluation Metrics and Baselines",
            "text": "The following metrics are used to measure the performance of future prediction task in various aspects: (i) L2 distance between the prediction and ground truth at multiple time steps, (ii) miss-rate with a threshold in terms of L2 distance at multiple time steps, (iii) maximum L2 distance over entire time frames, (iv) maximum miss-rate over entire time frames, and (v) oracle error over top K number of samples (i.e., Eoracle = min\u2200k\u2208K E(Y\u0302 (k)i \u2212 Yi)) to account for the uncertainty in the future prediction (similar to MEE in [46]). We set K to be 50 throughout the main experiments.\nWe compare our method with the following baselines: \u2022 Linear: A linear regressor that estimates linear parameters\nby minimizing the least square error. \u2022 RNN ED: An RNN encoder-decoder model that directly\nregresses the prediction only using the past trajectories. \u2022 RNN ED-SI: An RNN ED augmented with our SCF unit\ninto the decoder similar to [17]. The model combines the scene and interaction features while making prediction and uses the same information as ours, but makes a prediction at t+ 1 solely based on the past information up to t. \u2022 DESIRE: The proposed method. We denote our model with only semantic scene context in SCF module as DESIRE-S and our model with both scene context and interaction as DESIRE-SI. We also evaluate DESIRE-XIT{N}, where N is the number of iterative feedbacks."
        },
        {
            "heading": "4.3. Learning Details",
            "text": "We train the model with Adam optimizer [20] with the initial learning rate of 0.004. The learning rate is decreased by half at every quarter of total epochs, albeit we do not observe clear improvement with this. All the models including Encoder-decoder baselines are trained for 600 epochs for KITTI and 8 epochs for SDD (about 50K iterations with a batch size 32). The full details on the architecture are discussed in the supplementary materials. In order to avoid\nexploding gradient in RNNs, we apply gradient clipping with L2 norm of 1.0. During the training procedure, we randomly rotate the scene and trajectories to augment data and reduce over-fitting. For all experiments, we run randomized 5 fold cross validation without overlapping videos in different splits. All models observe maximum of 2 seconds for past trajectories and make a prediction up to 4 seconds into the future. All models are implemented using TensorFlow and trained end-to-end with a NVIDIA Tesla K80 GPU. Training takes approximately one to two days per model."
        },
        {
            "heading": "4.4. Analysis",
            "text": "Table 1 and Fig. 4 compare the oracle prediction errors3\nof various methods. We present L2 distance error for both datasets and miss-rate with 1m threshold for KITTI only, as trajectories in SDD are defined in image pixel space. Note that Linear, RNN ED, and RNN ED-SI output a single prediction, thus their results are shown as horizontal lines. CVAE samples are sorted randomly without confidence values. Baselines: RNN ED performs significantly better than Linear since it can learn non-linear motion. We observe that RNN ED-SI performs worse than RNN ED on the KITTI since the model learns to behave reactive (see Fig. 6). This might be due to the small size of the dataset, which makes it hard to learn predictive CNN/interaction features (i.e., features need to have high capacity to encode long-term information). On the contrary, RNN ED-SI significantly outperforms RNN ED on SDD dataset since SDD is much bigger and has a large number of interactions among agents. Proposed models: With a single random sample (CVAE 1 in Table 1), CVAE performs worse than RNN ED since RNN ED directly optimizes for L2 distance during training. Given more than few samples (e.g., CVAE 10% in Table 1), CVAE outperforms RNN ED quickly on both datasets, which confirms the multi-modal nature of the prediction problem. DESIRE-X-IT0 without iterative regression properly ranks the random CVAE samples achieving lower error with few samples. Note that DESIRE-X-IT0 only ranks the samples without regression, thus achieves the same error as used all samples, i.e., at Top K ratio of 1.0 in Fig. 4. As we iterate over, the outputs get refined and achieve smaller oracle error (i.e., DESIRE-X10%-IT0 vs. DESIRE-X10%-IT4). Fig. 5 shows an example of the iterative feedback. Finally, we observe that considering the interaction between agents further helps to achieve lower error. The difference between\n3The maximum error in Table 1 might be different from Fig. 4 due to the test examples without ground truth labels at 4 seconds in the future.\nDESIRE-S and DESIRE-SI is smaller in KITTI experiment, since KITTI has only few interactions between cars. However, we observe clear improvement on the SDD dataset since there are rich set of scenes with interactions between agents. Although our model with top 1 sample (DESIRE Best) achieves higher error compared to the direct regression baselines, using a few more samples yields much better prediction accuracy (i.e., DESIRE 10%). Note that direct regression models with lower error are not necessarily better if averaging various futures (e.g., going straight). We believe that in some applications, probabilistic prediction over a variety of outcomes is more desirable than a single MAP prediction. For both datasets, DESIRE achieves error on par with best baselines using as little as top 2 samples of DESIRE-SI-IT4 predictions (see Fig. 4). Qualitative results are presented in Fig. 6 and in the supplementary material.\nAblative study: We conduct further experiments for varying K and past length to supplement the main experiments and report the results in Table 2 and Table 3."
        },
        {
            "heading": "5. Conclusion",
            "text": "We introduce a novel framework DESIRE for distant future prediction of multiple agents in complex scene. The model incorporates both static and dynamic scene contexts with a deep IOC framework and produces stochastic, continuous, and time-profiled long-term predictions that can effectively account for the uncertainty in the future prediction task. Our empirical evaluations on driving and surveillance scenarios demonstrate clear improvement over other baselines. For future work, we believe that our model can be further improved on larger datasets and be applied to various robotics applications with a direct use of perspective images."
        },
        {
            "heading": "Acknowledgement",
            "text": "This work was part of N. Lee\u2019s summer internship at NEC Labs America and also supported by the EPSRC, ERC grant ERC-2012-AdG 321162-HELIOS, EPSRC grant Seebibyte EP/M013774/1 and EPSRC/MURI grant EP/N019474/1."
        }
    ],
    "title": "DESIRE: Distant Future Prediction in Dynamic Scenes with Interacting Agents",
    "year": 2017
}